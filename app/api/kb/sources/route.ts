import { NextRequest, NextResponse } from 'next/server'; export const runtime='nodejs';
export async function POST(req:NextRequest){ const cookie=req.cookies.get('auth'); if(!cookie) return NextResponse.json({ok:false,error:'Not authenticated'},{status:401}); const kb=process.env.RETELL_KNOWLEDGE_BASE_ID; if(!kb) return NextResponse.json({ok:false,error:'RETELL_KNOWLEDGE_BASE_ID missing'},{status:500}); const api='https://api.retellai.com'; const key=process.env.RETELL_API_KEY; if(!key) return NextResponse.json({ok:false,error:'RETELL_API_KEY missing'},{status:500}); const form=await req.formData(); const url=`${api}/add-knowledge-base-sources/${kb}`; const res=await fetch(url,{method:'POST',headers:{'Authorization':`Bearer ${key}`},body:form}); const txt=await res.text(); if(!res.ok) return NextResponse.json({ok:false,error:txt},{status:res.status}); try{return NextResponse.json(JSON.parse(txt));}catch{return new NextResponse(txt,{status:200});}}
