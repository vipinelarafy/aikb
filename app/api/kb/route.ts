import { NextResponse } from 'next/server'; import { requireRole } from '@/lib/auth'; import { retellFetch } from '@/lib/retell';
export async function GET(){ try{requireRole('customer');}catch(e:any){return NextResponse.json({ok:false,error:e.message},{status:401});} const kb=process.env.RETELL_KNOWLEDGE_BASE_ID; if(!kb) return NextResponse.json({ok:false,error:'RETELL_KNOWLEDGE_BASE_ID missing'},{status:500}); const data=await retellFetch(`/get-knowledge-base/${kb}`); const sources=(data?.sources||data?.knowledge_base?.sources||[]).map((s:any)=>({id:s.source_id||s.id||s.locator,kind:s.source_type||s.kind||'unknown',locator:s.locator||s.url||s.name||'',status:s.status||'indexed',size:s.size||null,created_at:s.created_at||null})); return NextResponse.json(sources);} 
